generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  CUSTOMER
  ADMIN
}

enum OrderStatus {
  PENDING
  PROCESSING
  COMPLETED
  CANCELLED
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole @default(CUSTOMER)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  orders Order[]
}

// model Category {
//   id          String   @id @default(uuid())
//   name        String   @unique
//   slug        String   @unique
//   description String?
//   imageUrl    String?
//   isActive    Boolean   @default(true)
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
//   products  Product[]
// }

// ============================================
// CATEGORY SYSTEM
// ============================================

model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  parentId    String?  // null for root category
  storeType   String?  // eco-friendly, sustainable, handmade, local, digital, ebook, software, service, event, party
  metaTitle       String?
  metaDescription String?
  image       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    Category[] @relation("CategoryHierarchy")
  products  Product[]
  
  @@index([slug])
  @@index([parentId])
  @@index([storeType])
}

// ============================================
// ENUMS FOR PRODUCT
// ============================================

enum ProductType {
  PHYSICAL
  DIGITAL
  SERVICE
}

enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  OUT_OF_STOCK
  DISCONTINUED
}

enum DigitalDeliveryMethod {
  DOWNLOAD
  EMAIL
  LICENSE_KEY
  ONLINE_ACCESS
}

// ============================================
// MAIN PRODUCT TABLE (Common attributes)
// ============================================

model Product {
  id          String   @id @default(cuid())
  sku         String   @unique
  name        String
  slug        String   @unique
  description String?  @db.Text
  shortDescription String? @db.Text
  
  productType ProductType
  status      ProductStatus @default(DRAFT)
  
  // Pricing
  basePrice   Decimal  @db.Decimal(10, 2)
  salePrice   Decimal? @db.Decimal(10, 2)
  costPrice   Decimal? @db.Decimal(10, 2)
  
  // Weight & Dimensions (for shipping calculations)
  weight      Decimal? @db.Decimal(10, 2) // in kg
  length      Decimal? @db.Decimal(10, 2) // in cm
  width       Decimal? @db.Decimal(10, 2) // in cm
  height      Decimal? @db.Decimal(10, 2) // in cm
  
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  
  // Product Characteristics Flags
  isFeatured      Boolean @default(false)
  isEcoFriendly   Boolean @default(false)
  isHandmade      Boolean @default(false)
  isLocal         Boolean @default(false)
  isSustainable   Boolean @default(false)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime?

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  // Relations
  images              ProductImage[]
  variants            ProductVariant[]
  inventory           Inventory?
  digitalProduct      DigitalProduct?
  eventSupply         EventSupply?
  attributes          ProductAttribute[]
  
  @@index([productType])
  @@index([status])
  @@index([slug])
  @@index([sku])
}



// ============================================
// PRODUCT VARIANTS (for size, color, etc.)
// ============================================

model ProductVariant {
  id        String  @id @default(cuid())
  productId String
  
  sku       String  @unique
  name      String
  price     Decimal @db.Decimal(10, 2)
  
  // Variant attributes (e.g., color, size)
  attributes Json?  // { "color": "Red", "size": "Large" }
  
  // Weight & Dimensions
  weight    Decimal? @db.Decimal(10, 2)
  
  // Images specific to this variant
  image     String?
  
  sortOrder Int     @default(0)
  isActive  Boolean @default(true)
  
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  inventory Inventory?
  
  @@index([productId])
}

// ============================================
// INVENTORY MANAGEMENT
// ============================================

model Inventory {
  id              String   @id @default(cuid())
  productId       String?  @unique
  variantId       String?  @unique
  
  quantity        Int      @default(0)
  reservedQuantity Int     @default(0)
  lowStockAlert   Int      @default(10)
  
  // Tracking
  warehouseLocation String?
  reorderPoint      Int?     // when to reorder
  reorderQuantity   Int?     // how much to reorder
  
  updatedAt       DateTime @updatedAt
  
  product         Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant         ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)
  
  @@index([quantity])
}

// ============================================
// DIGITAL PRODUCTS (E-books, Software, etc.)
// ============================================

model DigitalProduct {
  id              String   @id @default(cuid())
  productId       String   @unique
  
  // Digital-specific fields
  fileUrl         String?
  fileSize        Int?
  fileType        String? 
  
  downloadLimit   Int?     // null = unlimited
  expiryDays      Int?     // null = never expires
  
  deliveryMethod  DigitalDeliveryMethod
  
  // For software/licenses
  licenseKey      String?
  version         String?
  systemRequirements String? @db.Text
  compatibleOS    String?  // Windows, Mac, Linux, iOS, Android
  
  // For e-books
  author          String?
  publisher       String?
  isbn            String?
  pageCount       Int?
  language        String?
  format          String? 
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}


// ============================================
// EVENT SUPPLIES (Event Supplies, Party Decorations)
// ============================================

model EventSupply {
  id              String   @id @default(cuid())
  productId       String   @unique

  eventType       String?  // birthday, wedding, corporate, graduation, etc.
  ageGroup        String?  // kids, teens, adults, all-ages
  
  // Rental information
  isRentable      Boolean  @default(false)
  rentalPricePerDay Decimal? @db.Decimal(10, 2)
  depositRequired Decimal? @db.Decimal(10, 2)
  rentalDuration  Int?  
  
  minimumOrder    Int?
  maximumOrder    Int?

  isReusable      Boolean  @default(false)
  isDisposable    Boolean  @default(false)
  isCustomizable  Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ============================================
// PRODUCT IMAGES
// ============================================

model ProductImage {
  id        String   @id @default(cuid())
  productId String
  
  url       String
  altText   String?
  isPrimary Boolean  @default(false)
  sortOrder Int      @default(0)
  
  createdAt DateTime @default(now())
  
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@index([productId])
  @@index([isPrimary])
}

// ============================================
// PRODUCT ATTRIBUTES (Flexible key-value)
// For storing additional custom properties
// ============================================

model ProductAttribute {
  id        String  @id @default(cuid())
  productId String
  
  key       String  // e.g., "material", "origin", "certification", "color", "brand"
  value     String  // e.g., "organic cotton", "USA", "Fair Trade", "Blue", "EcoLife"
  
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  @@unique([productId, key])
  @@index([productId])
  @@index([key])
}


// ============= product model design ==============
// model Product {
//   id          String    @id @default(uuid())
//   name        String
//   description String?
//   price       Float
//   stock       Int       @default(0)
//   categoryId  String
//   isActive    Boolean   @default(true)
//   createdAt   DateTime  @default(now())
//   updatedAt   DateTime  @updatedAt

//   category    Category  @relation(fields: [categoryId], references: [id])

//   @@unique([name, categoryId])
//   orderItems OrderItem[]
// }

model Order {
  id          String       @id @default(uuid())
  userId      String
  totalAmount Float
  status      OrderStatus  @default(PENDING)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  user        User         @relation(fields: [userId], references: [id])
  items       OrderItem[]

}

model OrderItem {
  id        String   @id @default(uuid())
  orderId   String
  productId String
  quantity  Int      @default(1)
  price     Float

  order     Order    @relation(fields: [orderId], references: [id])

  @@unique([orderId, productId])
}

